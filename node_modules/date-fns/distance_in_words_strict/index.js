var compareDesc = require('../compare_desc/index.js')
var parse = require('../parse/index.js')
var differenceInSeconds = require('../difference_in_seconds/index.js')
var enLocale = require('../locale/en/index.js')

var MINUTES_IN_DAY = 1440
var MINUTES_IN_MONTH = 43200
var MINUTES_IN_YEAR = 525600

/**
 * @category Common Helpers
 * @summary Return the distance between the given dates in words.
 *
 * @description
 * Return the distance between the given dates in words, using strict units.
 * This is like `distanceInWords`, but does not use helpers like 'almost', 'over',
 * 'less than' and the like.
 *
 * | Distance between dates | Result              |
 * |------------------------|---------------------|
 * | 0 ... 59 secs          | [0..59] seconds     |
 * | 1 ... 59 mins          | [1..59] minutes     |
 * | 1 ... 23 hrs           | [1..23] hours       |
 * | 1 ... 29 days          | [1..29] days        |
 * | 1 ... 11 months        | [1..11] months      |
 * | 1 ... N years          | [1..N]  years       |
 *
 * @param ***REMOVED***Date|String|Number***REMOVED*** dateToCompare - the date to compare with
 * @param ***REMOVED***Date|String|Number***REMOVED*** date - the other date
 * @param ***REMOVED***Object***REMOVED*** [options] - the object with options
 * @param ***REMOVED***Boolean***REMOVED*** [options.addSuffix=false] - result indicates if the second date is earlier or later than the first
 * @param ***REMOVED***'s'|'m'|'h'|'d'|'M'|'Y'***REMOVED*** [options.unit] - if specified, will force a unit
 * @param ***REMOVED***'floor'|'ceil'|'round'***REMOVED*** [options.partialMethod='floor'] - which way to round partial units
 * @param ***REMOVED***Object***REMOVED*** [options.locale=enLocale] - the locale object
 * @returns ***REMOVED***String***REMOVED*** the distance in words
 *
 * @example
 * // What is the distance between 2 July 2014 and 1 January 2015?
 * var result = distanceInWordsStrict(
 *   new Date(2014, 6, 2),
 *   new Date(2015, 0, 2)
 * )
 * //=> '6 months'
 *
 * @example
 * // What is the distance between 1 January 2015 00:00:15
 * // and 1 January 2015 00:00:00?
 * var result = distanceInWordsStrict(
 *   new Date(2015, 0, 1, 0, 0, 15),
 *   new Date(2015, 0, 1, 0, 0, 0),
 * )
 * //=> '15 seconds'
 *
 * @example
 * // What is the distance from 1 January 2016
 * // to 1 January 2015, with a suffix?
 * var result = distanceInWordsStrict(
 *   new Date(2016, 0, 1),
 *   new Date(2015, 0, 1),
 *   ***REMOVED***addSuffix: true***REMOVED***
 * )
 * //=> '1 year ago'
 *
 * @example
 * // What is the distance from 1 January 2016
 * // to 1 January 2015, in minutes?
 * var result = distanceInWordsStrict(
 *   new Date(2016, 0, 1),
 *   new Date(2015, 0, 1),
 *   ***REMOVED***unit: 'm'***REMOVED***
 * )
 * //=> '525600 minutes'
 *
 * @example
 * // What is the distance from 1 January 2016
 * // to 28 January 2015, in months, rounded up?
 * var result = distanceInWordsStrict(
 *   new Date(2015, 0, 28),
 *   new Date(2015, 0, 1),
 *   ***REMOVED***unit: 'M', partialMethod: 'ceil'***REMOVED***
 * )
 * //=> '1 month'
 *
 * @example
 * // What is the distance between 1 August 2016 and 1 January 2015 in Esperanto?
 * var eoLocale = require('date-fns/locale/eo')
 * var result = distanceInWordsStrict(
 *   new Date(2016, 7, 1),
 *   new Date(2015, 0, 1),
 *   ***REMOVED***locale: eoLocale***REMOVED***
 * )
 * //=> '1 jaro'
 */
function distanceInWordsStrict (dirtyDateToCompare, dirtyDate, dirtyOptions) ***REMOVED***
  var options = dirtyOptions || ***REMOVED******REMOVED***

  var comparison = compareDesc(dirtyDateToCompare, dirtyDate)

  var locale = options.locale
  var localize = enLocale.distanceInWords.localize
  if (locale && locale.distanceInWords && locale.distanceInWords.localize) ***REMOVED***
    localize = locale.distanceInWords.localize
  ***REMOVED***

  var localizeOptions = ***REMOVED***
    addSuffix: Boolean(options.addSuffix),
    comparison: comparison
  ***REMOVED***

  var dateLeft, dateRight
  if (comparison > 0) ***REMOVED***
    dateLeft = parse(dirtyDateToCompare)
    dateRight = parse(dirtyDate)
  ***REMOVED*** else ***REMOVED***
    dateLeft = parse(dirtyDate)
    dateRight = parse(dirtyDateToCompare)
  ***REMOVED***

  var unit
  var mathPartial = Math[options.partialMethod ? String(options.partialMethod) : 'floor']
  var seconds = differenceInSeconds(dateRight, dateLeft)
  var offset = dateRight.getTimezoneOffset() - dateLeft.getTimezoneOffset()
  var minutes = mathPartial(seconds / 60) - offset
  var hours, days, months, years

  if (options.unit) ***REMOVED***
    unit = String(options.unit)
  ***REMOVED*** else ***REMOVED***
    if (minutes < 1) ***REMOVED***
      unit = 's'
    ***REMOVED*** else if (minutes < 60) ***REMOVED***
      unit = 'm'
    ***REMOVED*** else if (minutes < MINUTES_IN_DAY) ***REMOVED***
      unit = 'h'
    ***REMOVED*** else if (minutes < MINUTES_IN_MONTH) ***REMOVED***
      unit = 'd'
    ***REMOVED*** else if (minutes < MINUTES_IN_YEAR) ***REMOVED***
      unit = 'M'
    ***REMOVED*** else ***REMOVED***
      unit = 'Y'
    ***REMOVED***
  ***REMOVED***

  // 0 up to 60 seconds
  if (unit === 's') ***REMOVED***
    return localize('xSeconds', seconds, localizeOptions)

  // 1 up to 60 mins
  ***REMOVED*** else if (unit === 'm') ***REMOVED***
    return localize('xMinutes', minutes, localizeOptions)

  // 1 up to 24 hours
  ***REMOVED*** else if (unit === 'h') ***REMOVED***
    hours = mathPartial(minutes / 60)
    return localize('xHours', hours, localizeOptions)

  // 1 up to 30 days
  ***REMOVED*** else if (unit === 'd') ***REMOVED***
    days = mathPartial(minutes / MINUTES_IN_DAY)
    return localize('xDays', days, localizeOptions)

  // 1 up to 12 months
  ***REMOVED*** else if (unit === 'M') ***REMOVED***
    months = mathPartial(minutes / MINUTES_IN_MONTH)
    return localize('xMonths', months, localizeOptions)

  // 1 year up to max Date
  ***REMOVED*** else if (unit === 'Y') ***REMOVED***
    years = mathPartial(minutes / MINUTES_IN_YEAR)
    return localize('xYears', years, localizeOptions)
  ***REMOVED***

  throw new Error('Unknown unit: ' + unit)
***REMOVED***

module.exports = distanceInWordsStrict
