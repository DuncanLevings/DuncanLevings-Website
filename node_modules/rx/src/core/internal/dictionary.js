  var Dictionary = (function () ***REMOVED***

    var primes = [1, 3, 7, 13, 31, 61, 127, 251, 509, 1021, 2039, 4093, 8191, 16381, 32749, 65521, 131071, 262139, 524287, 1048573, 2097143, 4194301, 8388593, 16777213, 33554393, 67108859, 134217689, 268435399, 536870909, 1073741789, 2147483647],
      noSuchkey = "no such key",
      duplicatekey = "duplicate key";

    function isPrime(candidate) ***REMOVED***
      if ((candidate & 1) === 0) ***REMOVED*** return candidate === 2; ***REMOVED***
      var num1 = Math.sqrt(candidate),
        num2 = 3;
      while (num2 <= num1) ***REMOVED***
        if (candidate % num2 === 0) ***REMOVED*** return false; ***REMOVED***
        num2 += 2;
      ***REMOVED***
      return true;
    ***REMOVED***

    function getPrime(min) ***REMOVED***
      var index, num, candidate;
      for (index = 0; index < primes.length; ++index) ***REMOVED***
        num = primes[index];
        if (num >= min) ***REMOVED*** return num; ***REMOVED***
      ***REMOVED***
      candidate = min | 1;
      while (candidate < primes[primes.length - 1]) ***REMOVED***
        if (isPrime(candidate)) ***REMOVED*** return candidate; ***REMOVED***
        candidate += 2;
      ***REMOVED***
      return min;
    ***REMOVED***

    function stringHashFn(str) ***REMOVED***
      var hash = 757602046;
      if (!str.length) ***REMOVED*** return hash; ***REMOVED***
      for (var i = 0, len = str.length; i < len; i++) ***REMOVED***
        var character = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + character;
        hash = hash & hash;
      ***REMOVED***
      return hash;
    ***REMOVED***

    function numberHashFn(key) ***REMOVED***
      var c2 = 0x27d4eb2d;
      key = (key ^ 61) ^ (key >>> 16);
      key = key + (key << 3);
      key = key ^ (key >>> 4);
      key = key * c2;
      key = key ^ (key >>> 15);
      return key;
    ***REMOVED***

    var getHashCode = (function () ***REMOVED***
      var uniqueIdCounter = 0;

      return function (obj) ***REMOVED***
        if (obj == null) ***REMOVED*** throw new Error(noSuchkey); ***REMOVED***

        // Check for built-ins before tacking on our own for any object
        if (typeof obj === 'string') ***REMOVED*** return stringHashFn(obj); ***REMOVED***
        if (typeof obj === 'number') ***REMOVED*** return numberHashFn(obj); ***REMOVED***
        if (typeof obj === 'boolean') ***REMOVED*** return obj === true ? 1 : 0; ***REMOVED***
        if (obj instanceof Date) ***REMOVED*** return numberHashFn(obj.valueOf()); ***REMOVED***
        if (obj instanceof RegExp) ***REMOVED*** return stringHashFn(obj.toString()); ***REMOVED***
        if (typeof obj.valueOf === 'function') ***REMOVED***
          // Hack check for valueOf
          var valueOf = obj.valueOf();
          if (typeof valueOf === 'number') ***REMOVED*** return numberHashFn(valueOf); ***REMOVED***
          if (typeof obj === 'string') ***REMOVED*** return stringHashFn(valueOf); ***REMOVED***
        ***REMOVED***
        if (obj.hashCode) ***REMOVED*** return obj.hashCode(); ***REMOVED***

        var id = 17 * uniqueIdCounter++;
        obj.hashCode = function () ***REMOVED*** return id; ***REMOVED***;
        return id;
      ***REMOVED***;
    ***REMOVED***());

    function newEntry() ***REMOVED***
      return ***REMOVED*** key: null, value: null, next: 0, hashCode: 0 ***REMOVED***;
    ***REMOVED***

    function Dictionary(capacity, comparer) ***REMOVED***
      if (capacity < 0) ***REMOVED*** throw new Error('out of range'); ***REMOVED***
      if (capacity > 0) ***REMOVED*** this._initialize(capacity); ***REMOVED***

      this.comparer = comparer || defaultComparer;
      this.freeCount = 0;
      this.size = 0;
      this.freeList = -1;
    ***REMOVED***

    var dictionaryProto = Dictionary.prototype;

    dictionaryProto._initialize = function (capacity) ***REMOVED***
      var prime = getPrime(capacity), i;
      this.buckets = new Array(prime);
      this.entries = new Array(prime);
      for (i = 0; i < prime; i++) ***REMOVED***
        this.buckets[i] = -1;
        this.entries[i] = newEntry();
      ***REMOVED***
      this.freeList = -1;
    ***REMOVED***;

    dictionaryProto.add = function (key, value) ***REMOVED***
      this._insert(key, value, true);
    ***REMOVED***;

    dictionaryProto._insert = function (key, value, add) ***REMOVED***
      if (!this.buckets) ***REMOVED*** this._initialize(0); ***REMOVED***
      var index3,
        num = getHashCode(key) & 2147483647,
        index1 = num % this.buckets.length;
      for (var index2 = this.buckets[index1]; index2 >= 0; index2 = this.entries[index2].next) ***REMOVED***
        if (this.entries[index2].hashCode === num && this.comparer(this.entries[index2].key, key)) ***REMOVED***
          if (add) ***REMOVED*** throw new Error(duplicatekey); ***REMOVED***
          this.entries[index2].value = value;
          return;
        ***REMOVED***
      ***REMOVED***
      if (this.freeCount > 0) ***REMOVED***
        index3 = this.freeList;
        this.freeList = this.entries[index3].next;
        --this.freeCount;
      ***REMOVED*** else ***REMOVED***
        if (this.size === this.entries.length) ***REMOVED***
          this._resize();
          index1 = num % this.buckets.length;
        ***REMOVED***
        index3 = this.size;
        ++this.size;
      ***REMOVED***
      this.entries[index3].hashCode = num;
      this.entries[index3].next = this.buckets[index1];
      this.entries[index3].key = key;
      this.entries[index3].value = value;
      this.buckets[index1] = index3;
    ***REMOVED***;

    dictionaryProto._resize = function () ***REMOVED***
      var prime = getPrime(this.size * 2),
        numArray = new Array(prime);
      for (index = 0; index < numArray.length; ++index) ***REMOVED***  numArray[index] = -1; ***REMOVED***
      var entryArray = new Array(prime);
      for (index = 0; index < this.size; ++index) ***REMOVED*** entryArray[index] = this.entries[index]; ***REMOVED***
      for (var index = this.size; index < prime; ++index) ***REMOVED*** entryArray[index] = newEntry(); ***REMOVED***
      for (var index1 = 0; index1 < this.size; ++index1) ***REMOVED***
        var index2 = entryArray[index1].hashCode % prime;
        entryArray[index1].next = numArray[index2];
        numArray[index2] = index1;
      ***REMOVED***
      this.buckets = numArray;
      this.entries = entryArray;
    ***REMOVED***;

    dictionaryProto.remove = function (key) ***REMOVED***
      if (this.buckets) ***REMOVED***
        var num = getHashCode(key) & 2147483647,
          index1 = num % this.buckets.length,
          index2 = -1;
        for (var index3 = this.buckets[index1]; index3 >= 0; index3 = this.entries[index3].next) ***REMOVED***
          if (this.entries[index3].hashCode === num && this.comparer(this.entries[index3].key, key)) ***REMOVED***
            if (index2 < 0) ***REMOVED***
              this.buckets[index1] = this.entries[index3].next;
            ***REMOVED*** else ***REMOVED***
              this.entries[index2].next = this.entries[index3].next;
            ***REMOVED***
            this.entries[index3].hashCode = -1;
            this.entries[index3].next = this.freeList;
            this.entries[index3].key = null;
            this.entries[index3].value = null;
            this.freeList = index3;
            ++this.freeCount;
            return true;
          ***REMOVED*** else ***REMOVED***
            index2 = index3;
          ***REMOVED***
        ***REMOVED***
      ***REMOVED***
      return false;
    ***REMOVED***;

    dictionaryProto.clear = function () ***REMOVED***
      var index, len;
      if (this.size <= 0) ***REMOVED*** return; ***REMOVED***
      for (index = 0, len = this.buckets.length; index < len; ++index) ***REMOVED***
        this.buckets[index] = -1;
      ***REMOVED***
      for (index = 0; index < this.size; ++index) ***REMOVED***
        this.entries[index] = newEntry();
      ***REMOVED***
      this.freeList = -1;
      this.size = 0;
    ***REMOVED***;

    dictionaryProto._findEntry = function (key) ***REMOVED***
      if (this.buckets) ***REMOVED***
        var num = getHashCode(key) & 2147483647;
        for (var index = this.buckets[num % this.buckets.length]; index >= 0; index = this.entries[index].next) ***REMOVED***
          if (this.entries[index].hashCode === num && this.comparer(this.entries[index].key, key)) ***REMOVED***
            return index;
          ***REMOVED***
        ***REMOVED***
      ***REMOVED***
      return -1;
    ***REMOVED***;

    dictionaryProto.count = function () ***REMOVED***
      return this.size - this.freeCount;
    ***REMOVED***;

    dictionaryProto.tryGetValue = function (key) ***REMOVED***
      var entry = this._findEntry(key);
      return entry >= 0 ?
        this.entries[entry].value :
        undefined;
    ***REMOVED***;

    dictionaryProto.getValues = function () ***REMOVED***
      var index = 0, results = [];
      if (this.entries) ***REMOVED***
        for (var index1 = 0; index1 < this.size; index1++) ***REMOVED***
          if (this.entries[index1].hashCode >= 0) ***REMOVED***
            results[index++] = this.entries[index1].value;
          ***REMOVED***
        ***REMOVED***
      ***REMOVED***
      return results;
    ***REMOVED***;

    dictionaryProto.get = function (key) ***REMOVED***
      var entry = this._findEntry(key);
      if (entry >= 0) ***REMOVED*** return this.entries[entry].value; ***REMOVED***
      throw new Error(noSuchkey);
    ***REMOVED***;

    dictionaryProto.set = function (key, value) ***REMOVED***
      this._insert(key, value, false);
    ***REMOVED***;

    dictionaryProto.containskey = function (key) ***REMOVED***
      return this._findEntry(key) >= 0;
    ***REMOVED***;

    return Dictionary;
  ***REMOVED***());
