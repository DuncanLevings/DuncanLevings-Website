  var StopAndWaitObservable = (function (__super__) ***REMOVED***

    function subscribe (observer) ***REMOVED***
      this.subscription = this.source.subscribe(new StopAndWaitObserver(observer, this, this.subscription));

      var self = this;
      timeoutScheduler.schedule(function () ***REMOVED*** self.source.request(1); ***REMOVED***);

      return this.subscription;
    ***REMOVED***

    inherits(StopAndWaitObservable, __super__);

    function StopAndWaitObservable (source) ***REMOVED***
      __super__.call(this, subscribe, source);
      this.source = source;
    ***REMOVED***

    var StopAndWaitObserver = (function (__sub__) ***REMOVED***

      inherits(StopAndWaitObserver, __sub__);

      function StopAndWaitObserver (observer, observable, cancel) ***REMOVED***
        __sub__.call(this);
        this.observer = observer;
        this.observable = observable;
        this.cancel = cancel;
      ***REMOVED***

      var stopAndWaitObserverProto = StopAndWaitObserver.prototype;

      stopAndWaitObserverProto.completed = function () ***REMOVED***
        this.observer.onCompleted();
        this.dispose();
      ***REMOVED***;

      stopAndWaitObserverProto.error = function (error) ***REMOVED***
        this.observer.onError(error);
        this.dispose();
      ***REMOVED***

      stopAndWaitObserverProto.next = function (value) ***REMOVED***
        this.observer.onNext(value);

        var self = this;
        timeoutScheduler.schedule(function () ***REMOVED***
          self.observable.source.request(1);
        ***REMOVED***);
      ***REMOVED***;

      stopAndWaitObserverProto.dispose = function () ***REMOVED***
        this.observer = null;
        if (this.cancel) ***REMOVED***
          this.cancel.dispose();
          this.cancel = null;
        ***REMOVED***
        __sub__.prototype.dispose.call(this);
      ***REMOVED***;

      return StopAndWaitObserver;
    ***REMOVED***(AbstractObserver));

    return StopAndWaitObservable;
  ***REMOVED***(Observable));


  /**
   * Attaches a stop and wait observable to the current observable.
   * @returns ***REMOVED***Observable***REMOVED*** A stop and wait observable.
   */
  ControlledObservable.prototype.stopAndWait = function () ***REMOVED***
    return new StopAndWaitObservable(this);
  ***REMOVED***;
