   /**
   *  Runs all observable sequences in parallel and collect their last elements.
   *
   * @example
   *  1 - res = Rx.Observable.forkJoin([obs1, obs2]);
   *  1 - res = Rx.Observable.forkJoin(obs1, obs2, ...);
   * @returns ***REMOVED***Observable***REMOVED*** An observable sequence with an array collecting the last elements of all the input sequences.
   */
  Observable.forkJoin = function () ***REMOVED***
    var allSources = argsOrArray(arguments, 0);
    return new AnonymousObservable(function (subscriber) ***REMOVED***
      var count = allSources.length;
      if (count === 0) ***REMOVED***
        subscriber.onCompleted();
        return disposableEmpty;
      ***REMOVED***
      var group = new CompositeDisposable(),
        finished = false,
        hasResults = new Array(count),
        hasCompleted = new Array(count),
        results = new Array(count);

      for (var idx = 0; idx < count; idx++) ***REMOVED***
        (function (i) ***REMOVED***
          var source = allSources[i];
          isPromise(source) && (source = observableFromPromise(source));
          group.add(
            source.subscribe(
              function (value) ***REMOVED***
              if (!finished) ***REMOVED***
                hasResults[i] = true;
                results[i] = value;
              ***REMOVED***
            ***REMOVED***,
            function (e) ***REMOVED***
              finished = true;
              subscriber.onError(e);
              group.dispose();
            ***REMOVED***,
            function () ***REMOVED***
              if (!finished) ***REMOVED***
                if (!hasResults[i]) ***REMOVED***
                    subscriber.onCompleted();
                    return;
                ***REMOVED***
                hasCompleted[i] = true;
                for (var ix = 0; ix < count; ix++) ***REMOVED***
                  if (!hasCompleted[ix]) ***REMOVED*** return; ***REMOVED***
                ***REMOVED***
                finished = true;
                subscriber.onNext(results);
                subscriber.onCompleted();
              ***REMOVED***
            ***REMOVED***));
        ***REMOVED***)(idx);
      ***REMOVED***

      return group;
    ***REMOVED***);
  ***REMOVED***;
