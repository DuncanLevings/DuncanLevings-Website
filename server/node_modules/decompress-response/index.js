'use strict';
const PassThrough = require('stream').PassThrough;
const zlib = require('zlib');
const mimicResponse = require('mimic-response');

module.exports = response => ***REMOVED***
	// TODO: Use Array#includes when targeting Node.js 6
	if (['gzip', 'deflate'].indexOf(response.headers['content-encoding']) === -1) ***REMOVED***
		return response;
	***REMOVED***

	const unzip = zlib.createUnzip();
	const stream = new PassThrough();

	mimicResponse(response, stream);

	unzip.on('error', err => ***REMOVED***
		if (err.code === 'Z_BUF_ERROR') ***REMOVED***
			stream.end();
			return;
		***REMOVED***

		stream.emit('error', err);
	***REMOVED***);

	response.pipe(unzip).pipe(stream);

	return stream;
***REMOVED***;
